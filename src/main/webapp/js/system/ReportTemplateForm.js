var ReportTemplateForm=function(b,c){this.reportId=b;this.isDefaultIn=c;var a=this.setup();var d=new Ext.Window({id:"ReportTemplateFormWin",title:"报表详细信息",width:600,autoHeight:true,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[this.setup()],buttons:[{text:"保存",iconCls:"btn-save",disabled:this.isDefaultIn==1?true:false,handler:function(){var e=Ext.getCmp("ReportTemplateForm");if(e.getForm().isValid()){var f=e.getForm().findField("reportKey").getValue();if(f==null||f==""||f=="undefined"||(b!=null&&b!="undefined")){e.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(g,h){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ReportTemplateGrid").getStore().reload();d.close();},failure:function(g,h){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});d.close();}});}else{Ext.Ajax.request({url:__ctxPath+"/system/checkKeyReportTemplate.do",method:"POST",success:function(g,i){var j=Ext.decode(g.responseText);var h=j.totalCounts*1;if(h<1){e.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(k,l){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ReportTemplateGrid").getStore().reload();d.close();},failure:function(k,l){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});d.close();}});}else{Ext.ux.Toast.msg("操作信息","该报表Key已存在,不能重复保存!");return;}},failure:function(g,h){},params:{Q_reportKey_S_EQ:e.getForm().findField("reportKey").getValue()}});}}}},{text:"取消",iconCls:"btn-cancel",handler:function(){d.close();}}]});d.show();};ReportTemplateForm.prototype.setup=function(){function c(e){var f;for(var d=0;d<e.length;d++){f=e[d].filepath;Ext.getCmp("reportLocation").setValue(f);}}var a=new Ext.FormPanel({url:__ctxPath+"/system/saveReportTemplate.do",layout:"form",id:"ReportTemplateForm",frame:true,defaults:{widht:400,anchor:"100%,100%"},formId:"ReportTemplateFormId",defaultType:"textfield",items:[{name:"reportTemplate.reportId",id:"reportId",xtype:"hidden",value:this.reportId==null?"":this.reportId},{name:"reportTemplate.createtime",id:"createtime",xtype:"hidden"},{fieldLabel:"报表标题",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.title",id:"title",allowBlank:false,blankText:"报表标题不能为空"},{fieldLabel:"报表描述",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.descp",id:"descp",xtype:"htmleditor",height:200,allowBlank:false,blankText:"报表描述不能为空"},{xtype:"container",height:26,layout:"column",defaultType:"textfield",items:[{xtype:"label",style:"padding-left:0px;margin-left:0px;margin-bottom:2px;",text:"报表模块路径:",width:103},{columnWidth:0.8,name:"reportTemplate.reportLocation",id:"reportLocation",readOnly:this.isDefaultIn==1?true:false,allowBlank:false,blankText:"报表模块jasper文件路径不能为空"},{xtype:"button",text:"上传附件",columnWidth:0.2,disabled:this.isDefaultIn==1?true:false,handler:function(){var d=App.createUploadDialog({permitted_extensions:["zip","jasper"],url:__ctxPath+"/jasper-upload",file_cat:"system",callback:c});d.show("queryBtn");}}]},{fieldLabel:"报表Key",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.reportKey",id:"reportKey",allowBlank:true},{fieldLabel:"是否缺省",readOnly:this.isDefaultIn==1?true:false,hiddenName:"reportTemplate.isDefaultIn",id:"isDefaultIn",allowBlank:false,blankText:"是否缺省不能为空",xtype:"combo",value:0,store:new Ext.data.ArrayStore({fields:["i","n"],data:[[0,"否"],[1,"是"]]}),displayField:"n",valueField:"i",typeAhead:true,mode:"local",triggerAction:"all",forceSelection:true}]});var b=this.reportId;a.on("afterrender",function(d){if(b!=null&&b!="undefined"){d.getForm().load({deferredRender:false,url:__ctxPath+"/system/getReportTemplate.do?reportId="+b,waitMsg:"正在载入数据...",success:function(e,f){},failure:function(e,f){Ext.ux.Toast.msg("编辑","载入失败");}});d.getForm().findField("reportKey").readOnly=true;}});return a;};